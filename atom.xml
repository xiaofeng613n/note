<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>峰&#39;s Harbor</title>
  
  <subtitle>It is never too late to learn.</subtitle>
  <link href="/note.github.io/atom.xml" rel="self"/>
  
  <link href="https://xiaofeng613n.github.io/"/>
  <updated>2017-10-15T14:01:50.817Z</updated>
  <id>https://xiaofeng613n.github.io/</id>
  
  <author>
    <name>xiaofeng</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>flume配置</title>
    <link href="https://xiaofeng613n.github.io/2017/10/15/flume%E9%85%8D%E7%BD%AE/"/>
    <id>https://xiaofeng613n.github.io/2017/10/15/flume配置/</id>
    <published>2017-10-15T13:35:49.000Z</published>
    <updated>2017-10-15T14:01:50.817Z</updated>
    
    <content type="html"><![CDATA[<p><strong>环境</strong><br>linux:centos7<br>flume:1.7<br>kafka:kafka_2.10-0.10.1.0(已安装好，<a href="http://" target="_blank" rel="external">kafka安装</a>)</p><h6 id="1-下载flume，解压"><a href="#1-下载flume，解压" class="headerlink" title="1.下载flume，解压"></a>1.下载flume，解压</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># pwd</div><div class="line">/usr/local/soft/apache-flume-1.7.0-bin</div><div class="line"># ls</div><div class="line">bin  CHANGELOG  conf  DEVNOTES  doap_Flume.rdf  docs  lib  LICENSE  NOTICE  README.md  RELEASE-NOTES  tools</div></pre></td></tr></table></figure><h6 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h6><p>在conf目录根据模板配置文件flume-conf.properties.template配置agent和collect<br>这里在一台机器上配置了3个agent和1个collect,如下：  </p><p>agent1.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">agent1.sources = s1</div><div class="line">agent1.channels = c1</div><div class="line">agent1.sinks = k1</div><div class="line"></div><div class="line">agent1.sources.s1.type=exec</div><div class="line">agent1.sources.s1.command=tail -F /usr/local/soft/log/a.log</div><div class="line">agent1.sources.s1.channels=c1</div><div class="line">agent1.channels.c1.type=memory</div><div class="line">agent1.channels.c1.capacity=10000</div><div class="line">agent1.channels.c1.transactionCapacity=100</div><div class="line">#设置接收器</div><div class="line">agent1.sinks.k1.channel=c1</div><div class="line">agent1.sinks.k1.type= avro</div><div class="line">agent1.sinks.k1.hostname=192.168.1.108</div><div class="line">agent1.sinks.k1.port=40041</div></pre></td></tr></table></figure></p><p>agent2.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">agent2.sources = s1</div><div class="line">agent2.channels = c1</div><div class="line">agent2.sinks = k1</div><div class="line"></div><div class="line">agent2.sources.s1.type=exec</div><div class="line">agent2.sources.s1.command=tail -F /usr/local/soft/log/b.log</div><div class="line">agent2.sources.s1.channels=c1</div><div class="line">agent2.channels.c1.type=memory</div><div class="line">agent2.channels.c1.capacity=10000</div><div class="line">agent2.channels.c1.transactionCapacity=100</div><div class="line">#设置接收器</div><div class="line">agent2.sinks.k1.channel=c1</div><div class="line">agent2.sinks.k1.type= avro</div><div class="line">agent2.sinks.k1.hostname=192.168.1.108</div><div class="line">agent2.sinks.k1.port=40041</div></pre></td></tr></table></figure></p><p>agent3.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">agent3.sources = s1</div><div class="line">agent3.channels = c1</div><div class="line">agent3.sinks = k1</div><div class="line"></div><div class="line">agent3.sources.s1.type=exec</div><div class="line">agent3.sources.s1.command=tail -F /usr/local/soft/log/c.log</div><div class="line">agent3.sources.s1.channels=c1</div><div class="line">agent3.channels.c1.type=memory</div><div class="line">agent3.channels.c1.capacity=10000</div><div class="line">agent3.channels.c1.transactionCapacity=100</div><div class="line">#设置接收器</div><div class="line">agent3.sinks.k1.channel=c1</div><div class="line">agent3.sinks.k1.type= avro</div><div class="line">agent3.sinks.k1.hostname=192.168.1.108</div><div class="line">agent3.sinks.k1.port=40041</div></pre></td></tr></table></figure></p><p>collect.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">agentx.sources = s1</div><div class="line">agentx.channels = c1</div><div class="line">agentx.sinks = k1</div><div class="line"></div><div class="line">agentx.sources.s1.channels = c1</div><div class="line">agentx.sources.s1.type = avro</div><div class="line">agentx.sources.s1.bind = 192.168.1.108</div><div class="line">agentx.sources.s1.port = 40041</div><div class="line">agentx.sources.s1.threads = 2</div><div class="line"></div><div class="line">agentx.channels.c1.type=memory</div><div class="line">agentx.channels.c1.capacity=10000</div><div class="line">agentx.channels.c1.transactionCapacity=100</div><div class="line"></div><div class="line">#设置kafka接收器</div><div class="line">agentx.sinks.k1.type= org.apache.flume.sink.kafka.KafkaSink</div><div class="line">#设置Kafka的broker地址和端口号</div><div class="line">agentx.sinks.k1.brokerList=192.168.1.108:9093</div><div class="line">#设置Kafka的Topic</div><div class="line">agentx.sinks.k1.topic=topicOfFlume</div><div class="line">#设置序列化方式</div><div class="line">agentx.sinks.k1.serializer.class=kafka.serializer.StringEncoder</div><div class="line"></div><div class="line">agentx.sinks.k1.channel=c1</div></pre></td></tr></table></figure></p><p>可以看出3个agent的配置基本相同，就是sources监听文件不一样</p><h6 id="3-启动"><a href="#3-启动" class="headerlink" title="3.启动"></a>3.启动</h6><p>（注意：-n 后的参数要和配置文件中的agent名相同）<br>在flume目录下执行如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># bin/flume-ng agent --conf ./conf/ -f conf/collect.properties -Dflume.root.logger=DEBUG,console -n agentx</div><div class="line"># bin/flume-ng agent --conf ./conf/ -f conf/agent1.properties -Dflume.root.logger=DEBUG,console -n agent1</div><div class="line"># bin/flume-ng agent --conf ./conf/ -f conf/agent2.properties -Dflume.root.logger=DEBUG,console -n agent2</div><div class="line"># bin/flume-ng agent --conf ./conf/ -f conf/agent3.properties -Dflume.root.logger=DEBUG,console -n agent3</div></pre></td></tr></table></figure></p><p>启动是否成功可以查看（这是在一台机器上部署的）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># jps | grep App*</div><div class="line">26160 Application</div><div class="line">41320 Application</div><div class="line">26266 Application</div><div class="line">26205 Application</div></pre></td></tr></table></figure></p><h6 id="4-测试"><a href="#4-测试" class="headerlink" title="4.测试"></a>4.测试</h6><p>手动或脚本向监听的文件添加内容，kafka中会有数据写入,测试消费：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaTest</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException</span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">testConsumer();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testConsumer</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line"></div><div class="line">Properties props = <span class="keyword">new</span> Properties();</div><div class="line">props.put(<span class="string">"bootstrap.servers"</span>, <span class="string">"192.168.1.108:9093"</span>);</div><div class="line">props.put(<span class="string">"group.id"</span>, <span class="string">"groupC"</span>);</div><div class="line"><span class="comment">//props.put("enable.auto.commit", "true");</span></div><div class="line"><span class="comment">//props.put("auto.commit.interval.ms", "1000");</span></div><div class="line">props.put(<span class="string">"auto.offset.reset"</span>, <span class="string">"earliest"</span>);</div><div class="line">props.put(<span class="string">"key.deserializer"</span>, <span class="string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);</div><div class="line">props.put(<span class="string">"value.deserializer"</span>, <span class="string">"org.apache.kafka.common.serialization.StringDeserializer"</span>);</div><div class="line">KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> KafkaConsumer&lt;&gt;(props);</div><div class="line">consumer.subscribe(Arrays.asList(<span class="string">"topicOfFlume"</span>));</div><div class="line"><span class="keyword">while</span> (<span class="keyword">true</span>)</div><div class="line">&#123;</div><div class="line">ConsumerRecords&lt;String, String&gt; records = consumer.poll(<span class="number">100</span>);</div><div class="line"><span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records)</div><div class="line">&#123;</div><div class="line">System.out.printf(<span class="string">"offset = %d, key = %s, value = %s%n"</span>, record.offset(), record.key(), record.value());</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka-clients<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.10.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;环境&lt;/strong&gt;&lt;br&gt;linux:centos7&lt;br&gt;flume:1.7&lt;br&gt;kafka:kafka_2.10-0.10.1.0(已安装好，&lt;a href=&quot;http://&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;kafk
      
    
    </summary>
    
    
      <category term="flume-ng" scheme="https://xiaofeng613n.github.io/tags/flume-ng/"/>
    
  </entry>
  
  <entry>
    <title>my first post</title>
    <link href="https://xiaofeng613n.github.io/2017/10/03/my-first-post%20-%20%E5%89%AF%E6%9C%AC%20(2)/"/>
    <id>https://xiaofeng613n.github.io/2017/10/03/my-first-post - 副本 (2)/</id>
    <published>2017-10-03T07:31:18.000Z</published>
    <updated>2017-10-03T07:58:26.149Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="spring" scheme="https://xiaofeng613n.github.io/categories/spring/"/>
    
    
      <category term="aop" scheme="https://xiaofeng613n.github.io/tags/aop/"/>
    
      <category term="ioc" scheme="https://xiaofeng613n.github.io/tags/ioc/"/>
    
  </entry>
  
  <entry>
    <title>my first post</title>
    <link href="https://xiaofeng613n.github.io/2017/10/03/my-first-post%20-%20%E5%89%AF%E6%9C%AC/"/>
    <id>https://xiaofeng613n.github.io/2017/10/03/my-first-post - 副本/</id>
    <published>2017-10-03T07:31:18.000Z</published>
    <updated>2017-10-03T09:40:31.354Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="java" scheme="https://xiaofeng613n.github.io/categories/java/"/>
    
    
      <category term="aop" scheme="https://xiaofeng613n.github.io/tags/aop/"/>
    
      <category term="ioc" scheme="https://xiaofeng613n.github.io/tags/ioc/"/>
    
  </entry>
  
  <entry>
    <title>my first post</title>
    <link href="https://xiaofeng613n.github.io/2017/10/03/my-first-post%20-%20%E5%89%AF%E6%9C%AC%20(3)/"/>
    <id>https://xiaofeng613n.github.io/2017/10/03/my-first-post - 副本 (3)/</id>
    <published>2017-10-03T07:31:18.000Z</published>
    <updated>2017-10-03T07:58:26.149Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="spring" scheme="https://xiaofeng613n.github.io/categories/spring/"/>
    
    
      <category term="aop" scheme="https://xiaofeng613n.github.io/tags/aop/"/>
    
      <category term="ioc" scheme="https://xiaofeng613n.github.io/tags/ioc/"/>
    
  </entry>
  
  <entry>
    <title>my first post</title>
    <link href="https://xiaofeng613n.github.io/2017/10/03/my-first-post/"/>
    <id>https://xiaofeng613n.github.io/2017/10/03/my-first-post/</id>
    <published>2017-10-03T07:31:18.000Z</published>
    <updated>2017-10-03T09:40:43.401Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="java" scheme="https://xiaofeng613n.github.io/categories/java/"/>
    
    
      <category term="aop" scheme="https://xiaofeng613n.github.io/tags/aop/"/>
    
      <category term="ioc" scheme="https://xiaofeng613n.github.io/tags/ioc/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://xiaofeng613n.github.io/2017/10/03/hello-world/"/>
    <id>https://xiaofeng613n.github.io/2017/10/03/hello-world/</id>
    <published>2017-10-03T05:05:40.250Z</published>
    <updated>2017-10-03T03:30:51.561Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
  </entry>
  
</feed>
